<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册功能调试指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { color: #2563eb; }
        h2 { color: #1e40af; margin-top: 30px; }
        .step {
            background: #f3f4f6;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2563eb;
        }
        .warning {
            background: #fef3c7;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }
        .success {
            background: #d1fae5;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #10b981;
        }
        code {
            background: #1f2937;
            color: #f9fafb;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🔍 考山盟注册功能调试指南</h1>

    <div class="success">
        <strong>✅ 已确认：</strong>登录功能正常，Supabase 连接正常
    </div>

    <h2>步骤 1：检查注册入口</h2>
    <div class="step">
        <p><strong>在登录页面上：</strong></p>
        <ol>
            <li>找到登录表单下方的文字链接：<strong>"没有账号？立即注册"</strong></li>
            <li>点击这个链接后，按钮文字应该从 <code>登录</code> 变成 <code>注册账号</code></li>
            <li>如果按钮文字没有变化，说明前端 JavaScript 有问题</li>
        </ol>
    </div>

    <h2>步骤 2：打开浏览器开发者工具</h2>
    <div class="step">
        <ol>
            <li>在浏览器中按 <code>F12</code> 打开开发者工具</li>
            <li>切换到 <strong>Console（控制台）</strong> 标签</li>
            <li>清空之前的日志（点击 🚫 图标）</li>
            <li>点击 "立即注册" 链接</li>
            <li>观察控制台是否有错误信息</li>
        </ol>
    </div>

    <h2>步骤 3：测试注册流程</h2>
    <div class="step">
        <ol>
            <li>确保表单已切换到注册模式（按钮显示"注册账号"）</li>
            <li>填写一个新的邮箱地址（不要用已注册的）</li>
            <li>填写密码（至少 6 位）</li>
            <li>点击 <strong>"注册账号"</strong> 按钮</li>
            <li>观察：
                <ul>
                    <li>是否显示 "注册中..." 的加载状态？</li>
                    <li>是否有任何提示信息（成功或失败）？</li>
                    <li>控制台是否有错误信息？</li>
                </ul>
            </li>
        </ol>
    </div>

    <h2>步骤 4：检查 Network（网络）请求</h2>
    <div class="step">
        <ol>
            <li>在开发者工具中切换到 <strong>Network（网络）</strong> 标签</li>
            <li>清空之前的请求记录</li>
            <li>再次尝试注册</li>
            <li>查找发送到 Supabase 的请求：
                <ul>
                    <li>URL 应该包含 <code>tdvjpfuuzkwhmtogwavj.supabase.co</code></li>
                    <li>路径应该是 <code>/auth/v1/signup</code></li>
                    <li>查看请求的状态码（200 表示成功，400/422 表示失败）</li>
                    <li>点击请求，查看 Response（响应）内容</li>
                </ul>
            </li>
        </ol>
    </div>

    <h2>常见问题和解决方案</h2>

    <div class="warning">
        <h3>问题 1：点击"立即注册"没有反应</h3>
        <p><strong>可能原因：</strong>前端 JavaScript 加载失败</p>
        <p><strong>解决方案：</strong></p>
        <ul>
            <li>检查控制台是否有 JavaScript 错误</li>
            <li>尝试清除浏览器缓存后重新加载页面（Ctrl+Shift+R）</li>
            <li>检查 Docker 容器日志：<code>docker compose logs -f</code></li>
        </ul>
    </div>

    <div class="warning">
        <h3>问题 2：点击"注册账号"后没有反应</h3>
        <p><strong>可能原因：</strong>Supabase 请求失败或被阻止</p>
        <p><strong>解决方案：</strong></p>
        <ul>
            <li>检查 Network 标签中的请求状态</li>
            <li>如果看到 400/422 错误，查看响应内容了解具体原因</li>
            <li>可能是邮箱已被注册，尝试使用不同的邮箱</li>
        </ul>
    </div>

    <div class="warning">
        <h3>问题 3：注册成功但无法登录</h3>
        <p><strong>可能原因：</strong>Supabase 要求邮箱验证</p>
        <p><strong>解决方案：</strong></p>
        <ul>
            <li>检查注册邮箱是否收到验证邮件</li>
            <li>或者在 Supabase 后台关闭邮箱验证：
                <br>Authentication → Settings → Email Auth → 关闭 "Enable email confirmations"
            </li>
        </ul>
    </div>

    <h2>Supabase 后台配置检查清单</h2>
    <div class="step">
        <p>登录 <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a>，检查以下设置：</p>

        <h3>1. Site URL 配置</h3>
        <p>路径：<code>Authentication → URL Configuration → Site URL</code></p>
        <pre>http://124.220.74.191:3000</pre>

        <h3>2. Redirect URLs 配置</h3>
        <p>路径：<code>Authentication → URL Configuration → Redirect URLs</code></p>
        <pre>http://124.220.74.191:3000/auth/callback
http://124.220.74.191:3000</pre>

        <h3>3. 邮箱验证设置（可选）</h3>
        <p>路径：<code>Authentication → Settings → Email Auth</code></p>
        <ul>
            <li><strong>测试环境：</strong>建议关闭 "Enable email confirmations"</li>
            <li><strong>生产环境：</strong>建议开启邮箱验证，并配置好邮件服务</li>
        </ul>
    </div>

    <h2>快速测试方案</h2>
    <div class="success">
        <p><strong>如果想快速验证注册功能是否正常：</strong></p>
        <ol>
            <li>在 Supabase Dashboard 中关闭邮箱验证</li>
            <li>使用一个全新的邮箱地址注册</li>
            <li>注册成功后应该可以直接登录</li>
        </ol>
    </div>

    <h2>需要帮助？</h2>
    <div class="step">
        <p>如果按照以上步骤仍然无法解决问题，请提供以下信息：</p>
        <ul>
            <li>浏览器控制台的错误信息（截图）</li>
            <li>Network 标签中 Supabase 请求的详细信息</li>
            <li>Docker 容器日志：<code>docker compose logs --tail=100</code></li>
        </ul>
    </div>
</body>
</html>
